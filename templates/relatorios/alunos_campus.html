{% extends 'base/base.html' %}

{% block title %}Alunos por campus{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="mb-3">
        <label for="graphTypeSelect">Tipo de Gr√°fico:</label>
        <select id="graphTypeSelect" class="form-control">
            <option value="bar">Barra</option>
            <option value="pie">Pizza</option>
        </select>
    </div>

    <div class="chart-container" style="position: relative; height:40vh; width:80vw">
        <canvas id="alunosPorCampusChart"></canvas>
    </div>
    <div id="chartDetailsCampus" class="mt-3"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const dadosGrafico = {{ dados_grafico | safe }};
    const graphTypeSelect = document.getElementById('graphTypeSelect');
    const ctx = document.getElementById('alunosPorCampusChart').getContext('2d');
    let myChart = createChart(dadosGrafico, graphTypeSelect.value);

    graphTypeSelect.addEventListener('change', function() {
        myChart.destroy();
        myChart = createChart(dadosGrafico, graphTypeSelect.value);
    });

    function createChart(data, chartType) {
        const campusNomes = data.map(item => item.nome);
        const campusAlunos = data.map(item => item.total_alunos);

        const detailsElement = document.getElementById('chartDetailsCampus');
        detailsElement.innerHTML = `Total de campi: ${campusNomes.length}<br>Total de alunos: ${campusAlunos.reduce((sum, current) => sum + current, 0)}`;

        return new Chart(ctx, {
            type: chartType,
            data: {
                labels: campusNomes,
                datasets: [{
                    label: 'Alunos por Campus',
                    data: campusAlunos,
                    backgroundColor: campusNomes.map((_, i) => `rgba(${i * 50 % 255}, ${i * 80 % 255}, ${i * 110 % 255}, 0.5)`),
                    borderColor: campusNomes.map((_, i) => `rgba(${i * 50 % 255}, ${i * 80 % 255}, ${i * 110 % 255}, 1)`),
                    borderWidth: 1
                }]
            },
            options: {
                scales: chartType === 'bar' ? { y: { beginAtZero: true } } : {},
                responsive: true,
                maintainAspectRatio: false
            }
        });
    }
});
</script>
{% endblock %}
